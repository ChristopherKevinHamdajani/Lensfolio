<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add Event</title>
    <link th:href="@{styles/main.css}" rel="stylesheet" />
    <link th:href="@{styles/form.css}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <script src="webjars/jquery/3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
</head>
<body>
<div class="project-header">
    <div class="title">
        <div class="title-name">Add Event</div>
    </div>
</div>


<div class="content">
    <form method="post" onsubmit="return validateName();" th:action="@{add-event}" th:object="${event}">
        <label for="eventName">Event Name</label> <br/>
        <input onkeyup="updateCharsLeft()" id="eventName" type="text" maxlength="50" th:name="eventName" th:field="*{eventName}">
        <div class="name-length-message" >
            <span id="eventNameLength"></span>
        </div>
        <div class="horizontal-group">
            <div class="horizontal-group-element" >
                <label for="eventStartDate">Event Start Date</label> <br/>
                <div class="input-group date" id="eventStart">
                    <input onkeydown="return checkDateKeys(event)" type="text" class="form-control" th:field="*{startDateString}" id="eventStartDate">
                    <span class="input-group-append">
                            <span class="input-group-text bg-white">
                                <i class="bi bi-calendar"></i>
                            </span>
                        </span>
                </div>
            </div>
            <div class="horizontal-group-element" >
                <label for="eventEndDate">Event End Date</label> <br/>
                <div class="input-group date" id="eventEnd">
                    <input onkeydown="return checkDateKeys(event)" type="text" class="form-control" th:field="*{endDateString}" id="eventEndDate">
                    <span class="input-group-append">
                            <span class="input-group-text bg-white">
                                <i class="bi bi-calendar"></i>
                            </span>
                        </span>
                </div>
            </div>
        </div>
        <div class="horizontal-group">
            <div class="horizontal-group-element" >
                <label for="eventStartTime">Event Start Time</label> <br/>
                <div class="input-group date" id="eventTimeStart">
                    <input type="time" class="form-control" th:field="*{startTimeString}" id="eventStartTime">
                </div>
            </div>
            <div class="horizontal-group-element" >
                <label for="eventEndTime">Event End Time</label> <br/>
                <div class="input-group date" id="eventTimeEnd">
                    <input type="time" class="form-control" th:field="*{endTimeString}" id="eventEndTime">
                </div>
            </div>
        </div>
        <span id="eventDateError" style="color:red" th:text="${eventDateError}"></span>
        <span id="eventNameError" style="color:red" th:hidden = "true"> Invalid event name, must be between 1 and 50 characters.</span>
        <br/>
        <a th:href="@{details}"><button class="cancel" type="button">Cancel</button></a>
        <button id="saveButton" class="save" type="submit">Save</button>
    </form>
</div>
</body>
<script src="js/project.js"></script>
<script>
    // Sets default values for the time picker
    document.getElementById("eventStartTime").defaultValue = "12:00";
    document.getElementById("eventEndTime").defaultValue = "13:00";
</script>
<script>
    /**
     * Checks the entered event dates in the input fields and displays an error message if there's a related error.
     * Disables the save button if there is an error.
     */
    function updateEventDateError() {
        document.getElementById("saveButton").disabled = false;
        const data = {
            eventStartDate: document.getElementById("eventStartDate").value,
            eventEndDate: document.getElementById("eventEndDate").value,
            eventStartTime: document.getElementById("eventStartTime").value,
            eventEndTime: document.getElementById("eventEndTime").value
        }
        $.post("add-event/error?" + new URLSearchParams(data)).done(function (fragment) {
            console.log(fragment);
            $("#eventDateError").replaceWith(fragment);
            document.getElementById("saveButton").disabled = document.getElementById("eventDateError").textContent.trim().length > 0;
        });
    }



    // Runs updateEventDateError function whenever the entered dates change
    document.getElementById("eventStartDate").onchange = updateEventDateError;
    document.getElementById("eventEndDate").onchange = updateEventDateError;
    document.getElementById("eventStartTime").onchange = updateEventDateError;
    document.getElementById("eventEndTime").onchange = updateEventDateError;

    // Initial run of updateEventDateError function in case initial values are invalid
    updateEventDateError();
</script>


<script>
    // Checks whether the name is too long or null
    function validateName() {
        document.getElementById("eventNameError").hidden = true;
        if (document.getElementById('eventName').value.length === 0 || document.getElementById('eventName').value.length > 50 ) {
            document.getElementById("eventNameError").hidden = false;
            return false
        }
        return true
    }
    document.getElementById("eventName").onchange = validateName;
</script>
<script>
    //updates characters left
    function updateCharsLeft() {
        let chars_left = 50 - document.getElementById("eventName").value.length;
        if (chars_left === 50) {
            document.getElementById("eventNameLength").innerText = "";
        } else if (chars_left === 1) {
            document.getElementById("eventNameLength").innerText = chars_left + " character left";
        } else if (chars_left === 0) {
            document.getElementById("eventNameLength").innerText = "No characters left";
        } else {
            document.getElementById("eventNameLength").innerText = chars_left + " characters left";
        }
    }
</script>

<script type="text/javascript">
    // fills in the date pickers
    $(function() {
        $('#eventStart').datepicker({format: 'dd/M/yyyy'});
    });
</script>
<script type="text/javascript">
    $(function() {
        $('#eventEnd').datepicker({format: 'dd/M/yyyy'});
    });
</script>

</html>